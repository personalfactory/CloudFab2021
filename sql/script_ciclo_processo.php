<?php

function findProcessiByIdCiloIdMacchina($campoOrdine,$idCiclo,$idMacchina) {
   $stringSql = "SELECT * FROM 
                            serverdb.ciclo_processo                           
                        WHERE 
                            id_ciclo=".$idCiclo."
                        AND
                            id_macchina=".$idMacchina."
                        ORDER BY 
                            ".$campoOrdine;
    $sql = mysql_query($stringSql) or die("ERROR IN script_ciclo_processo - FUNCTION findProcessiByIdCiloIdMacchina - " . $stringSql . " : " . mysql_error());
    

    return $sql;
}



function findTotSacchiINProcesso($idMacchina,$idProdotto,$dataInf,$dataSup,$idParOrdineConf,$tipoConf){                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    $stringSql="SELECT 
            pr.nome_prodotto,
            v.valore,
            cp.id_processo
    FROM  serverdb.ciclo c 
        JOIN serverdb.ciclo_processo cp ON c.id_ciclo=cp.id_ciclo 
        JOIN serverdb.ordine_sing_mac o ON o.id_ordine=c.id_ordine
        JOIN serverdb.valore_par_ordine v ON o.id_ordine_sm=v.id_ordine_sm
        JOIN serverdb.prodotto pr ON pr.id_prodotto=c.id_prodotto
    WHERE c.id_macchina=v.id_macchina 
        AND v.id_par_ordine=".$idParOrdineConf."
        AND v.valore='".$tipoConf."'
        AND c.id_macchina=".$idMacchina." 
        AND c.id_prodotto=".$idProdotto."
        AND (substring(c.dt_abilitato,1,10)>='".$dataInf."' AND substring(c.dt_abilitato,1,10)<='".$dataSup."')
    GROUP BY pr.id_prodotto,cp.id_processo  
    ORDER BY pr.nome_prodotto";                               
          
     $sql = mysql_query($stringSql) 
                    or die("ERRORE IN script_ciclo_processo.php - FUNCTION findTotSacchiINProcesso - " .$stringSql." - ". mysql_error());
     return $sql;
 }
 
 /**
  * Conta tutti i processi fatti che non hanno nessun ordine di riferimento
  * @param type $idMacchina
  * @param type $idProdotto
  * @param type $dataInf
  * @param type $dataSup
  * @return type
  */
 function findTotProcessiSenzaOrdine($idMacchina,$idProdotto,$dataInf,$dataSup){                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    $stringSql="SELECT 
            pr.nome_prodotto,
            cp.id_processo
    FROM  serverdb.ciclo c 
        JOIN serverdb.ciclo_processo cp ON c.id_ciclo=cp.id_ciclo 
        JOIN serverdb.prodotto pr ON pr.id_prodotto=c.id_prodotto
    WHERE  
         c.id_macchina=".$idMacchina." 
        AND c.id_prodotto=".$idProdotto."
        AND (substring(c.dt_abilitato,1,10)>='".$dataInf."' AND substring(c.dt_abilitato,1,10)<='".$dataSup."')
    GROUP BY pr.id_prodotto,cp.id_processo  
    ORDER BY pr.nome_prodotto";                               
          
     $sql = mysql_query($stringSql) 
                    or die("ERRORE IN script_ciclo_processo.php - FUNCTION findTotSacchiINProcesso - " .$stringSql." - ". mysql_error());
     return $sql;
 }
 
 